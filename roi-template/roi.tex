% !TEX TS-program = pdflatex   
\documentclass[runningheads,12pt]{article} 
\usepackage{textcomp,color,longtable,landscape,float}
\restylefloat{table}
\def\headerTitle{CSE4312F12 Project -- ROI Solution}
\input{defns.tex} 
\hyphenpenalty 10000


\begin{document}

\title{CSE4312F12 Project Solution\\
ROI}

\author{Damien Gruel (cse23089@cse.yorku.ca)
\and Ludovic Lavalette (cse23088@cse.yorku.ca)}

\date{\today}

\maketitle


\section*{Note}
\begin{itemize}
\item A customer elicitation session was held during class on Tuesday November 6, 2012. If you were not there sure to catch up with a fellow student who was there.
\item This template is handed out \emph{caveat emptor}.  There may be errors and wrong information. It is ultimately your responsibility to elicit the correct requirements from the customer and to ensure that you satisfy the customer goals and specify correct output from the input.
\item Your are required to correct any errors or ambiguities in this template and use this template to produce your final requirements document.
\end{itemize}

\section*{Revisions}

\begin{tabular}{|l|l|p{3in}|}
\hline
Date & Revision& Description \\ 
\hline
10 October  2012 
& 1.0       
& Initial customer elicitation\\ 
\hline
15 November 2012
& 2.0       
& Initial Student solution       \\
\hline
1 December 2012
& 3.0       
& Final Student solution       \\
\hline
\end{tabular}

\newpage
\tableofcontents
\listoffigures
\listoftables

\newpage

\section{Context Diagram}



The following diagram is the context diagram for the ROI system.\\
\\
The monitored variables (which are the content of the CSV file, provided by the user), are :
\begin{itemize}
\item an header, which is composed of a required name, an optional description of the file and optional information about the customer (account number, email, address and phone number)
\item the evaluation dates (\textit{start} and \textit{end})
\item the tuple data (\textit{date}, \textit{market value}, \textit{cash flow}, \textit{agent fees} and \textit{benchmark}).
\end{itemize}
\bigskip
The format of the output is the following (whole input = everything between the earliest date and the latest date in the sequence of tuple data):\\
\\
Name: ??\\
--------------------------------------------\\
Whole input: yyyy-mm-dd to yyyy-mm-dd\\
TWR: ?? \%\\
ROI: ?? \%\\
Benchmark: ?? \%\\
--------------------------------------------\\
Evaluation Period: yyyy-mm-dd to yyyy-mm-dd\\
TWR: ?? \%\\
ROI: ?? \%\\
Benchmark: ?? \%\\
--------------------------------------------\\
\\
\\
The controlled variables are also a warning (if a calculation is not possible, if the evaluation period is not valid, or if the portfolio history has no name) and an error (if the CSV file is not valid).\\

\begin{figure}
\centering
\includegraphics[scale=1.0]{inputs/context.pdf}
\caption{Context diagram for the ROI system}
\label{fig:ROI-context}
\end{figure}
\section{Dictionary}

\smallskip


\noindent\textbf{Agent fees}: Money that the customer pays to the investment advisor to run the account.\smallskip

\noindent\textbf{Benchmark}: Standard used as a point of reference for evaluating performance.\smallskip

\noindent\textbf{Cash Flow}: Revenue or expense stream that changes a cash account over a given period.\smallskip

\noindent\textbf{CSV}: Comma Separated Value file format used to store tabular data in which numbers and text are stored in plain-text form that can be easily written and read in a text editor.\smallskip

\noindent\textbf{Customer}: The user of the software system.\smallskip

\noindent\textbf{Evaluation Period}: a start and end date (provided by the user) for the portfolio history over which the return on investment is calculated.\smallskip

\noindent\textbf{GIPS}: Global Investment Performance Standards\smallskip

\noindent\textbf{Investment broker}: Runs the portfolio on behalf of the customer and supplies portfolio accounts.\smallskip

\noindent\textbf{Portfolio statement}: List of all investments and current value.\smallskip

\noindent\textbf{Portfolio History}: the historical data of investment performance over time that the customer stores about their investments as gleaned from their monthly or yearly investment accounts. Usually stored by customers in a CSV file (see Figure 1).\smallskip

\noindent\textbf{ROI}: Return On Investment: Performance measure used to evaluate the efficiency of an investment.\smallskip

\noindent\textbf{TWR}: Time Weighted Return: Measure of the compound rate of growth in a portfolio.\smallskip

\noindent\textbf{Tuple data}: \textit{date}, \textit{market value}, \textit{cash flow}, \textit{agent fees} and \textit{benchmark}.\smallskip

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{E/R-descriptions}

\subsection{E-descriptions}

{\centering
\begin{longtable}{|l|p{9cm}|p{5cm}|}
\hline
\textbf{ID} & \textbf{Description} & \textbf{Comment}\\

\hline
E1 & Customers create and store a portfolio history, i.e. the historical data of their investment performance as determined from portfolio statements. & \\

\hline
E2 & Customers store their portfolio history as a CSV text file. CSV files may be prepared on editors of any operating system and encoded as ANSI or UTF-8. & \\

\hline
\end{longtable}
%%%


%%%
\centering
\begin{longtable}{|l|p{9cm}|p{5cm}|}

\hline
\multicolumn{3}{|c|}{\textbf{Header of the CSV file}} \\


\hline
E3.1 & Every portfolio history has a name. & \\

\hline
E3.2 & Optionally, every portfolio history has a description, account number, email, address, and phone number fields. & \\

\hline
\end{longtable}
%%%

%%%
\centering
\begin{longtable}{|l|p{9cm}|p{5cm}|}

\hline
\multicolumn{3}{|c|}{\textbf{Evaluation period in the CSV file}} \\

\hline
E4.1 & Optionally, every portfolio has an evaluation period that is between the start and end date of the historical performance data. & See Invariant 1 of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
E4.2 & The start date and the end date must be in ISO format (yyyy-mm-dd). & \\

\hline
E4.3 & The evaluation period is in range. & See Invariant 1 of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
\end{longtable}
%%%

%%%
\centering
\begin{longtable}{|l|p{9cm}|p{5cm}|}

\hline
\multicolumn{3}{|c|}{\textbf{Data in the CSV file}} \\

\hline
E5.1 & A portfolio history records investment performance in a non-empty sequence of tuple data, each tuple having the fields: date (required), market value (required), cash flow (optional), agent fees (optional) and benchmark (optional). & See \textit{tr} of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
E5.2 &  For each tuple, the dates must be in ISO format (yyyy-mm-dd). & \\

\hline
E5.3 & When there is a customer contribution, the cash flow is a positive number. For a withdrawal, the number is negative. & \\

\hline
E5.4 & Agent fees can be internal (deducted from within the portfolio) or external (additional amounts paid by the customer to the investment broker). The portfolio history reflects only external agent fees, always reported as a non-negative amount. & \\

\hline
E5.5 & Every data tuple (row in the CSV file) has a date and a non-negative market value. & See Invariant 2 of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
E5.6 &  Dates in the tuples are unique and ordered. & See Invariant 3 of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
E5.7 & No withdrawal in the tuple data can be greater than the market value. & See Invariant 4 of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
E5.8 & An account cannot grow from zero market value and cash flow. & See Invariant 5 of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
E5.9 &  For each tuple, the market value plus cash-flow plus agent-fees must be non-zero. & See precondition 3 of feature \textit{twr} of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
\end{longtable}
}


%%%%%%%%%%%%%%%%
\subsection{R-descriptions}

{\centering
\begin{longtable}{|l|p{9cm}|p{5cm}|}
\hline
\textbf{ID} & \textbf{Description} & \textbf{Comment}\\

\hline
R1 & All return on investment calculations shall follow the GIPS standard. & See twr, roi, benchmark (Fig.~\ref{tab:twr_calculation}) \\

\hline
\end{longtable}
%%%
\centering
\begin{longtable}{|l|p{9cm}|p{5cm}|}
\hline
\multicolumn{3}{|c|}{\textbf{Evaluation period}} \\

\hline
R2.1 & If no evaluation period is provided, then the start date is the earliest date and the end date the latest date in the sequence of tuple data. & See Start\_Valid and End\_Valid conditions of the function tables\\

\hline
R2.2 &  Warning message: If the evaluation dates are not valid, then the following error message shall be displayed to the user: "Invalid evaluation period" & See Function tables \\

\hline
\end{longtable}
%%%
\centering
\begin{longtable}{|l|p{9cm}|p{5cm}|}

\hline
\multicolumn{3}{|c|}{\textbf{CSV file}} \\

\hline
R3.1 &  Error message: If the CSV file is not valid (i.e. if any of the conditions mentioned above do not hold), then the following error message shall be displayed to the user: "Invalid file". & See Function tables\\

\hline
R3.2 &  Warning message: If the CSV file does not contain a name, then the following error message shall be displayed to the user: "Incomplete file: absence of name". & See Function table~\ref{table:ftable_name}\\

\hline
\end{longtable}
%%%
\centering
\begin{longtable}{|l|p{9cm}|p{5cm}|}

\hline
\multicolumn{3}{|c|}{\textbf{Calculation of the TWR}} \\

\hline
R4.1 & The system shall provide two TWRs (if each one is calculable) : one for the evaluation period, and one for the whole input. & See Function table~\ref{table:ftable_TWR} \\

\hline
R4.2 &  The TWRs shall be rounded to two decimal places. & \\

\hline
R4.3 & If the evaluation period is less than a year, then the TWR shall be reported in absolute terms as a percentage return (i.e. it is not annualized). If the evaluation period is a year or more, then the TWR is annualized to a percentage per year. & See postcondition of  \textit{annual\_compounded\_TWR} of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
R4.4 & The annualized TWR shall be reported as a percentage. & See \textit{annual\_compounded\_TWR} of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
R4.5 & Agent fees are treated like a deposit (the agent fees are \underline{added} to the market value and the cash flow). & See \textit{twr} of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
R4.6 & Warning message: If the TWR is not calculable, then a warning message shall be displayed to the user. & See Function table~\ref{table:ftable_TWR}\\

\hline
\end{longtable}
%%%
\centering
\begin{longtable}{|l|p{9cm}|p{5cm}|}

\hline
\multicolumn{3}{|c|}{\textbf{Calculation of the ROI}} \\

\hline
R5.1 & The system shall provide two ROIs : one for the evaluation period, and one for the whole input. & See Function table~\ref{table:ftable_ROI}\\

\hline
R5.2 &  The ROIs shall be rounded to two decimal places. & \\

\hline
R5.3 & The ROI shall be reported as a percentage. & See \textit{roi} of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
R5.4 & Agent fees are treated like a deposit (the agent fees are \underline{added} to the cash flow). & See \textit{roi} of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
\end{longtable}
%%%
\centering
\begin{longtable}{|l|p{9cm}|p{5cm}|}

\hline
\multicolumn{3}{|c|}{\textbf{Calculation of the Benchmark}} \\

\hline
R6.1 & The system shall provide two benchmarks (if each one is calculable) : one for the evaluation period, and one for the whole input. & See Function table~\ref{table:ftable_bench}\\

\hline
R6.2 &  The benchmarks shall be rounded to two decimal places. & \\

\hline
R6.3 & The benchmark shall be reported as a compounded ROI, if the benchmark figures are available for the evaluation period. & See \textit{benchmark} of TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})\\

\hline
R6.4 & Warning message: If the benchmark is not calculable, then a warning message shall be displayed to the user. & See Function table~\ref{table:ftable_bench}\\



\hline
\end{longtable}
}

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Mathematical model}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{figure}
\centering
\includegraphics[scale=0.8]{inputs/spec.pdf}
\input{inputs/roi-system}
\caption{Module specification of return on investment}
\end{figure}

\begin{figure}
\input{inputs/input-csv}
\caption{Type input-csv}
\label{fig:input}
\end{figure}

\newpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\tab}{\hspace*{2em}}

{
\centering
\begin{longtable}{|l|}

\hline
\multicolumn{1}{|c|}{\textbf{TWR\_ROI\_CALCULATION}}\\

\hline
\textbf{\comment input} (\textit{input.csv})\\
\\
\textit{tr}: SEQ[DATA]\\
\comment sequence of data [\textit{date, market\_value, cash\_flow, agent\_fees, benchmark}]\\
\comment \textit{tr.domain} = \{1,2,...,\textit{tr.count}\}\\
\\
\textit{count}: INTEGER$\eqdef$\textit{tr.count}\\
\\
\textit{dates}: SET[DATE]$\eqdef$\{\textit{t $\in$ tr$\itholds$t.date}\}\\
\\
$start:$ DATE $\eqdef tr[1]$ \comment first date of the file\\
$end:$ DATE $\eqdef tr[count]$ \comment last date of the file\\ 
\\
\textit{duration}: VALUE$\eqdef$ \textit{days(end - start)}$\div$(365.2422) \\
\comment years between \textit{start} and \textit{end} calculated by days\\
\comment \textit{days}(x) similar to Excel\\

\\
\\
\textbf{\comment output calculation} (\textit{input.out.csv})\\
\\
\textit{di (d}:DATE): INTEGER\\
\comment index into sequence of transaction for date \textit{d}\\
\require \textit{d $\in$ dates} \\
\ensure \textit{Result $\in$ tr.domain $\land$ tr[Result].date=d}\\
\\

TODO: DANS REQUIRE I VARIE DANS L'INTERVALLE D'INDICE DEFINIT PAR S ET E\\
IL FAUT VERIFIER QUE CE SOIT BIEN CA DANS LES E/R DESCRIPTIONS\\
\comment TWR for the period \textit{s .. e}\\
\textit{twr (s, e}: DATE): VALUE\\
\require\\
	\tab \textit{s, e $\in$ dates}\\
	\tab \textit{e $>$ s}\\
	\tab \textit{$\forall$i $\in$ di(s)+1..di(e)$\itholds$tr[i-1].mv + tr[i-1].cf + tr[i-1].af $\neq$ 0}\\
\ensure\\
	\tab \textit{Result $\eqdef$ ($\Pi$i:INTEGER $|$ di(s) $<$i$\le$ di(e)$\itholds$wealth(i)) - 1}\\
	\tab where \textit{wealth(i) $\eqdef$ tr[i].mv$\div$(tr[i-1].mv + tr[i-1].cf + tr[i-1].af)}\\
\\

\textit{annual\_compounded\_TWR (s, e}: DATE): VALUE \\
\ensure \\
	\tab \textit{(duration$\ge 1)\Rightarrow Result=((1+twr(s, e))^{1\div duration}-1)*100$}\\
	\tab \textit{(duration$<$1)$\Rightarrow$ Result= twr(s, e) * 100}\\
\\

TODO: IL FAUT RETIRER DES E-R DESCRIPTION QUE\\
 AF EST UN DEPOSIT AILLEUR QUE POUR LE TWR\\
TODO:VERIFIER QUE LE + POUR LES AGENT FEES\\
 CI DESSOUS EST CORRECT\\
\textit{roi (s, e}: DATE): VALUE\\
\require\\
	\tab \textit{s, e $\in$ dates}\\
	\tab\textit{e $>$ s}\\
\ensure\\
	\tab \textit{(tr[m].mv+tr[m].cf) $\ast (1+Result\div 100)^{days(e - s)\div365.2422}$ }\\
	\tab \tab \textit{+ ($\Sigma i:\nat  |  m <i<n\itholds (tr[i].cf + tr[i].af) \ast $}\\
	\tab \tab \textit{$(1+Result\div 100)^{days(e - tr[i].date)\div365.2422}) - tr[n].mv = 0$}\\
\where \\
	\tab \textit{m = di(s)}\\ 
	\tab \textit{n = di(e)}\\
\\
\\

$year(d:$ DATE): INTEGER\\
\require\\
\tab $d = "yyyy - mm - dd"$\\
\ensure\\
\tab $Result = yyyy$\\
\\	

$mon(d:$ DATE): INTEGER\\
\require\\
\tab $d = "yyyy - mm - dd"$\\
\ensure\\
\tab $Result = mm$\\
\\	

$day(d:$ DATE): INTEGER\\
\require\\
\tab$ d = "yyyy - mm - dd"$\\
\ensure\\
\tab $Result = dd$\\
\\	

TODO FAIRE LES FONCTION TABLE POUR MIN ET MAX\\
TODO VOIR POUR LE REQUIRE DE MIN ET MAX\\
$\uparrow$ ($f, s$: DATE): DATE\\
\require\\
\ensure\\
\tab $<<$ see table...$>>$\\
\\
$\downarrow$ ($f, s$: DATE): DATE\\
\require\\
\ensure\\
\tab $<<$ see table...$>>$\\
\\
TODO FAIRE ET NUMEROTER LA FUNCTION TABLE\\
 DE LA FCT SUIVANTE\\
\textit{at (d}: DATE): DATA\\
\ensure\\
\tab $<<see$ $table ... >>$ \\
\\

\textit{bm\_calculable (s, e}: DATE): $\Bool$\\
\require\\
\ensure\\
\tab $Result = at[end\downarrow a].bench \neq void $\\
\tab \tab $\wedge (\forall d \in DATE | mon(d) = day(d) = 1 \wedge year(s) \le year(d) \le year(e)$\\
\tab \tab \tab $\itholds at[d].bench \neq void)$\\
\tab \tab $\wedge ((C \wedge at[s].bench \neq void) \vee (\neg C \wedge at[end \downarrow b].bench \neq void))$\\
\where\\
\tab $a = "year(s)+1 - 01 - 01"$\\
\tab $b = "year(e)+1 - 01 - 01"$\\
\tab $C = mon(e) = 1 \wedge day(e) = 1$\\
\\

TODO RAJOUTER LA FUNCTION TABLE\\
\comment the function below return a set of DATA with a benchmark $\neq$ void\\
\textit{bm\_seq (s, e}: DATE): SEQ[DATA]\\
\require\\
\tab $s,e\in$ $dates$\\
\tab \textit{bm\_calculable(s, e) }\\
\ensure\\
\tab $Result = (\oplus i | di(s)<i < di(e) \wedge tr[i].bench \neq void \itholds <tr[i]>) \oplus <t>$\\

\where\\
\tab t = $<<$ see table ...$>>$\\
\\

TODO DEFINIR LA FONCTION PO()\\
$bm\_final\_value(s,e:$ DATE): VALUE\\
\require\\
\tab $s, e \in dates$\\
\tab $bm\_calculable(s,e) $\\
\ensure\\
\tab $Result \eqdef$\\
\tab $tr[m].mv \ast (\Pi i, seq, t| seq = bm\_seq(s, e) \wedge a \oplus seq[0] \wedge i \ge 1$\\
  \tab \tab $\wedge t = seq[i] \itholds t.bench^{po(s, e, seq[i-1].date, t.date)} )$\\
\tab $+ (\Sigma k | m \le k \le n \itholds (tr[k].cf - tr[k].af) \ast$\\
\tab \tab $(\Pi i,seq,t | seq = bm\_seq(tr[k].date, e) \wedge b(k) \oplus seq \wedge i \ge 1 $\\
\tab \tab $\wedge t = seq[i] \itholds t.bench^{po(s, e, seq[i-1].date, t.date)}))$\\
\where\\
\tab $m = di(s)$\\
\tab $n = di(e)$\\
{\hspace*{1em}} \comment $a$ defines seq[0] in the first product\\
{\hspace*{1em}} \comment $b(k)$ defines seq[0] in the second product\\
\tab$a = <("year(s) - 01 - 01", 0, 0, 0, void)>$\\
\tab$b(k) = <("year(tr[k].date) - 01 - 01", 0, 0, 0, void)>$ \\
\\

$benchmark (s, e$: DATE): VALUE\\
\require\\
\tab $s, e \in dates$\\
\tab $bm\_calculable(s, e)$\\
\ensure\\
\tab $tr[m].mv \ast (Result+1)^{days(e-s)\div365.2422}) $\\
\tab $+ (\Sigma k | m \le k \le n \itholds tr[k].cf \ast$\\
\tab \tab $(Result+1)^{days(e - tr[k].date)\div365.2422}) - FV= 0$\\
\where\\
\tab $m = di(s)$\\
\tab $n = di(e)$\\
\tab $FV \eqdef bm\_final\_value(s,e) $\\
\\


\hline
\textbf{Invariants}\\
\\
(1) \textit{ (start$<$end)$\wedge$(start,end$\in$dates)} \\
\comment metadata evaluation period is in range and valid\\
\\
(2) \textit{$\forall$t$\in$tr$\itholds$t.date$\neq$Void$\wedge$t.mv$\ge$0}\\
\comment every row has a date and a non-negative market value\\
\\
(3) \textit{$\forall$i$\in$2..count$\itholds$tr[i].date$>$tr[i-1].date}\\
\comment date are unique and ordered\\
\\
(4) \textit{$\forall$t$\in$tr$\itholds$t.mv+t.cf$\ge$0}\\
\comment Cannot withdraw more than the market value\\
\\
(5) \textit{$\forall$i$\in$2..count $|$ tr[i-1].mv=0$\wedge$tr[i-1].cf=0$\itholds$tr[i].mv=0}\\
\comment account coannot grow from zero market value and cash flow\\

\hline
\caption{Mathematical model for the ROI system}
\label{tab:twr_calculation}
\end{longtable}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{plain}
\bibliography{inputs/ref}







\newpage

%%%%%%%%%%%%%%%%%%%
\subsection{Function tables}

\subsubsection{Abbreviations, conditions and messages}
{\centering
\begin{longtable}{|l|p{11cm}|}
\hline
\textbf{Abbreviation} & \textbf{Description}\\

\hline
first & tr[1].date \\

\hline
last & tr[tr.count].date\\

\hline
 a\_c\_TWR & annual\_compounded\_TWR\\
& (see TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation})) \\

\hline
 b & benchmark (see TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation}))\\



\hline
\end{longtable}

\centering
\begin{longtable}{|l|p{12cm}|}
\hline
\textbf{Condition} & \textbf{Description}\\

\hline
C1 & \textit{$\forall$i $\in$ 2..count$\itholds$tr[i-1].mv + tr[i-1].cf + tr[i-1].af $\neq$ 0}\\

\hline
C2 & \textit{$\forall$i $\in$ di(start)+1..di(end)$\itholds$tr[i-1].mv + tr[i-1].cf + tr[i-1].af $\neq$ 0}\\

\hline
C3 & benchmark\_calculable(first,last)\\
& (see TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation}))\\

\hline
C4 & benchmark\_calculable(start,end)\\
&(see TWR\_ROI\_CALCULATION (Fig.~\ref{tab:twr_calculation}))\\

\hline
 Start\_Valid & (start $\in$ dates$\cup$\{null\}) $\wedge$ (start in ISO format)\\
& (if Start\_Valid $\wedge$ start=null, then start=tr[1].date)\\

\hline
 End\_Valid & (end $\in$ dates$\cup$\{null\}) $\wedge$ (end in ISO format)\\
&(if End\_Valid $\wedge$ end=null, then end=tr[tr.count].date)\\

\hline
Name & (csvfile.name = null)\\

\hline
\end{longtable}

\centering
\begin{longtable}{|l|p{13cm}|}
\hline
\textbf{Message} & \textbf{Description}\\

\hline
 E & "Invalid file"\\

\hline
W & "Invalid evaluation period"\\

\hline
W1 & "The TWR for the whole input is not calculable"\\

\hline
W2 & "The TWR's are not calculable"\\

\hline
W3 & W + W1\\

\hline
W4 &  "Benchmark for the whole input is not calculable"\\

\hline
W5 & "The benchmarks are not calculable"\\

\hline
W6 & W + W4\\

\hline
W7 & "Incomplete file: absence of name"\\

\hline

\end{longtable}
}

\begin{landscape}
\subsubsection{Calculation of the TWRs}

\begin{table}[H]
{
\centering
\begin{tabular}{|l|l|l|l||l|l|l|l|}
\hline
\multicolumn{4}{|c||}{} & Error & Warning &TWR & TWR\\ 
\multicolumn{4}{|l||}{}&&& (whole input) & (evaluation period)\\

\hline
Valid$\_$CSV & $\lnot$(Start$\_$Valid) $\vee$ & \multicolumn{2}{|l||}{C1} & | & W & a\_c\_TWR(first,last) & |\\ 
& $\lnot$(End$\_$Valid) $\vee$& \multicolumn{2}{|l||}{} &&& &\\
& end $\le$ start & \multicolumn{2}{|l||}{} &&& &\\

\cline{3-8}
& & \multicolumn{2}{|l||}{$\lnot$C1} & | & W3 & | & |\\ 


\cline{2-8}
& Start$\_$Valid  $\wedge$  & \multicolumn{2}{|l||}{C1} & | & | & a\_c\_TWR(first,last) & a\_c\_TWR(start,end)\\ 
& End$\_$Valid $\wedge$  & \multicolumn{2}{|l||}{} &&&&\\
& end$>$start   & \multicolumn{2}{|l||}{}&&&&\\

\cline{3-8}
&& $\lnot$C1 & C2 & | & W1 & | & a\_c\_TWR(start,end)\\

\cline{4-8}
&& & $\lnot$C2 & | & W2 & | & |\\

\hline
\multicolumn{4}{|l||}{Invalid$\_$CSV} & E & | & | & |\\ 

\hline
\end{tabular}

\caption{Function table for ROI system (calculation of the TWRs)}
\label{table:ftable_TWR}
}
\end{table}
\end{landscape}


%%%



\begin{landscape}
\subsubsection{Calculation of the ROIs}

\begin{table}[H]
{
\centering

\begin{tabular}{|l|l||l|l|l|l|}
\hline
\multicolumn{2}{|c||}{} & Error & Warning & ROI (whole input) & ROI (evaluation period)\\ 

\hline
Valid$\_$CSV & $\lnot$(Start$\_$Valid) $\vee$ & |& W & | & |\\ 
& $\lnot$(End$\_$Valid) $\vee$ &&&&\\
& end $\le$ start &&& &\\

\cline{2-6}
& Start$\_$Valid  $\wedge$ & |& | & roi(first,last) & roi(start,end)\\
& End$\_$Valid $\wedge$ &&&&\\
& end$>$start &&&&\\

\hline
\multicolumn{2}{|l||}{Invalid$\_$CSV} & E & |& | & |\\ 

\hline
\end{tabular}

\caption{Function table for ROI system (calculation of the ROIs)}
\label{table:ftable_ROI}
}
\end{table}
\end{landscape}

%%%


\begin{landscape}
\subsubsection{Calculation of the benchmarks}

\begin{table}[H]
{
\centering

\begin{tabular}{|l|l|l|l||l|l|l|l|}
\hline
\multicolumn{4}{|c||}{} & Error & Warning & Benchmark & Benchmark\\ 
\multicolumn{4}{|l||}{}&&&(whole input) & (evaluation period)\\


\hline
Valid$\_$CSV & $\lnot$(Start$\_$Valid) $\vee$ & \multicolumn{2}{|l||}{C3} & | & W & b(first,last) & |\\ 
& $\lnot$(End$\_$Valid) $\vee$& \multicolumn{2}{|l||}{} &&& &\\
& end $\le$ start & \multicolumn{2}{|l||}{} & &&&\\

\cline{3-8}
& & \multicolumn{2}{|l||}{$\lnot$C3}& | & W6 & | & |\\ 

\cline{2-8}
& Start$\_$Valid  $\wedge$  & \multicolumn{2}{|l||}{C3} & | & | & b(first,last) & b(start,end)\\ 
& End$\_$Valid $\wedge$  & \multicolumn{2}{|l||}{} &&&&\\
& end$>$start   & \multicolumn{2}{|l||}{}&&&&\\

\cline{3-8}
&& $\lnot$C3 & C4 & | & W4 & | & b(start,end)\\

\cline{4-8}
&& & $\lnot$C4 & | & W5 & | & |\\

\hline
\multicolumn{4}{|l||}{Invalid$\_$CSV} & E & |& |& |\\ 

\hline
\end{tabular}

\caption{Function table for ROI system (calculation of the benchmarks)}
\label{table:ftable_bench}
}
\end{table}
\end{landscape}

%%%

\subsubsection{Name of the portfolio history}

\begin{table}[H]
{
\centering

\begin{tabular}{|l||l|}
\hline
 & Warning\\ 

\hline
Name  & |\\ 

\hline
$\lnot$Name & W7 \\ 

\hline
\end{tabular}

\caption{Function table for ROI system (name of the portfolio history)}
\label{table:ftable_name}
}
\end{table}




\section{Acceptance tests}

\bigskip
{\centering
\begin{tabular}{|p{1.2in}|p{4in}|}
\hline
\textbf{Test Case ID} & T1 - test\_date\_invalid.csv \\ 
\hline
\textbf{Description} & Verify that an invalid date raises an error.\\
\hline
\textbf{Requirement IDs tested} & R3.1 \\ 
\hline
\textbf{Type} & Negative \\ 
\hline
\textbf{Initial State} & A directory containing the CSV file.\\
\hline 
\textbf{Action} & Execute the ROI system on the CSV file \\
\hline 
\textbf{Consequences} & Output : "Error: Invalid file." \\ 
\hline
\end{tabular}
%%%%
\bigskip\bigskip
\centering
\begin{tabular}{|p{1.2in}|p{4in}|}
\hline
\textbf{Test Case ID} & T2 - test\_date\_invalid\_February.csv \\ 
\hline
\textbf{Description} & Verify that an invalid date (because of the leap years) raises an error.\\
\hline
\textbf{Requirement IDs tested} & R3.1 \\ 
\hline
\textbf{Type} & Negative \\ 
\hline
\textbf{Initial State} & A directory containing the CSV file.\\
\hline 
\textbf{Action} & Execute the ROI system on the CSV file \\
\hline 
\textbf{Consequences} & Output : "Error: Invalid file." \\ 
\hline
\end{tabular}
%%%%
\bigskip
\centering
\begin{tabular}{|p{1.2in}|p{4in}|}
\hline
\textbf{Test Case ID} & T3 - test\_tuple\_without\_date.csv \\ 
\hline
\textbf{Description} & Verify that a tuple without a date raises an error.\\
\hline
\textbf{Requirement IDs tested} & E5.5 - R3.1 \\ 
\hline
\textbf{Type} & Negative \\ 
\hline
\textbf{Initial State} & A directory containing the CSV file.\\
\hline 
\textbf{Action} & Execute the ROI system on the CSV file \\
\hline 
\textbf{Consequences} & Output : "Error: Invalid file." \\ 
\hline
\end{tabular}
%%%%
\bigskip
\centering
\begin{tabular}{|p{1.2in}|p{4in}|}
\hline
\textbf{Test Case ID} & T4 - test\_negative\_market\_value.csv \\ 
\hline
\textbf{Description} & Verify that a negative market value raises an error.\\
\hline
\textbf{Requirement IDs tested} & E5.5 - R3.1 \\ 
\hline
\textbf{Type} & Negative \\ 
\hline
\textbf{Initial State} & A directory containing the CSV file.\\
\hline 
\textbf{Action} & Execute the ROI system on the CSV file \\
\hline 
\textbf{Consequences} & Output : "Error: Invalid file." \\ 
\hline
\end{tabular}
%%%%
\bigskip
\centering
\begin{tabular}{|p{1.2in}|p{4in}|}
\hline
\textbf{Test Case ID} & T5 - test\_dates\_non\_unique.csv \\ 
\hline
\textbf{Description} & Verify that two tuples with the same date raise an error.\\
\hline
\textbf{Requirement IDs tested} & E5.6 - R3.1 \\ 
\hline
\textbf{Type} & Negative \\ 
\hline
\textbf{Initial State} & A directory containing the CSV file.\\
\hline 
\textbf{Action} & Execute the ROI system on the CSV file \\
\hline 
\textbf{Consequences} & Output : "Error: Invalid file." \\ 
\hline
\end{tabular}
%%%%
\bigskip
\centering
\begin{tabular}{|p{1.2in}|p{4in}|}
\hline
\textbf{Test Case ID} & T6 - test\_dates\_non\_ordered.csv \\ 
\hline
\textbf{Description} & Verify that tuples which are not ordered raise an error.\\
\hline
\textbf{Requirement IDs tested} & E5.6 - R3.1 \\ 
\hline
\textbf{Type} & Negative \\ 
\hline
\textbf{Initial State} & A directory containing the CSV file.\\
\hline 
\textbf{Action} & Execute the ROI system on the CSV file \\
\hline 
\textbf{Consequences} & Output : "Error: Invalid file." \\ 
\hline
\end{tabular}
%%%%
\bigskip
\centering
\begin{tabular}{|p{1.2in}|p{4in}|}
\hline
\textbf{Test Case ID} & T7 - test\_withdraw.csv \\ 
\hline
\textbf{Description} & Verify that a withdraw which is greater that the market value raises an error.\\
\hline
\textbf{Requirement IDs tested} & E5.7 - R3.1 \\ 
\hline
\textbf{Type} & Negative \\ 
\hline
\textbf{Initial State} & A directory containing the CSV file.\\
\hline 
\textbf{Action} & Execute the ROI system on the CSV file \\
\hline 
\textbf{Consequences} & Output : "Error: Invalid file." \\ 
\hline
\end{tabular}
%%%%
\bigskip
\centering
\begin{tabular}{|p{1.2in}|p{4in}|}
\hline
\textbf{Test Case ID} & T8 - test\_grow.csv \\ 
\hline
\textbf{Description} & Verify that an account which grow from zero market value and cash flow raises an error.\\
\hline
\textbf{Requirement IDs tested} & E5.8 - R3.1 \\ 
\hline
\textbf{Type} & Negative \\ 
\hline
\textbf{Initial State} & A directory containing the CSV file.\\
\hline 
\textbf{Action} & Execute the ROI system on the CSV file \\
\hline 
\textbf{Consequences} & Output : "Error: Invalid file." \\ 
\hline
\end{tabular}
}







\section{Requirements Traceability matrix}

\begin{tabular}{|p{1.5in}|p{3.5in}|}
\hline
\textbf{Requirement ID}	 & \textbf{Test Case IDs}\\ 
\hline
R3.1 & T1, T2, T3, T4, T5, T6, T7, T8\\
\hline
\end{tabular}




\newpage
\appendix

\section{REGEXP}


A set of strings is used as the model for regular expressions. We use prefix operators for the Kleene closure (e.g. $*x$ where $x$ is a regular expression such as $\{\squote{hello}\}$) and iteration at least one or more (e.g. $\textrm{+}x$) rather than suffix operators. Note that where there is no confusion we use \squote{hello} instead of $\{\squote{hello}\}$ where the set is a singleton. 

We may use type REGEXP to specify a $FLOAT\_STRING$ as follows.

\begin{align}
FLOAT\_STRING = &\squote{+}Inf\\
&|\squote{-}Inf\\
&|NaN\\
&|(\squote{-}|\squote{+}|\epsilon)\cdot(^*d\cdot\squote{.}|\epsilon)\cdot
	^*\!\!d\cdot ((\squote{e}\cdot(\squote{-}|\epsilon)\cdot^\textrm{+}d)\,|\,\epsilon)\\
d = &\squote{0} | \squote{1} | \cdots |\squote{9} 
\end{align}

In the above we use the convention that \squote{e}, for example, really stands for the single set $\{\squote{e}\}$.


\begin{figure} [H]
\input{inputs/regexp}
\caption{Type REGEXP for regular expressions over printing characters}
\end{figure}

%  x^0
%=    { definition }
%   (⊙i : 0 ≤ i < 0 : x)
%=    { arithmetic }
%   (⊙i : false : x)
%=    { identity of ∙ }
%   1

% w ∈ x∙1
%=    { definition of ∙ }
%   (∃u,t:  w = u∙t:  u ∈ x ∧ t ∈ 1)
%=    { definition of 1 }
%   (∃u,t:  w = u∙t:  u ∈ x ∧ t ∈ { "" })
%=    { membership of a singleton set }
%   (∃u,t:  w = u∙t:  u ∈ x ∧ t = "")
%=    { one point rule }
%   (∃u:  w = u∙"":  u ∈ x)
%=    { identity of string catenation }
%   (∃u:  w = u:  u ∈ x)
%=    { one point rule }
%   w ∈ x
%%%%%%%%%%%%%%%%%%


\section{DATE}
The specification of the date module is provided on the following page.
\newpage

\centering 
%\begin{mdframed}%%Put a frame around the figure
%\subfigure[Module for DATE]{
    
%\begin{tikzpicture}
%\begin{class}[text width=11cm]{type DATE}{0, 0}
%\attribute{$\cset DATE$\newlineindent
%$\qquad \eqdef date(year,month,day:\nat)$\comment injective constructor\newlineindent 
%$\qquad\qquad \require valid\_date(year,month,date)$}
%\attribute{\const $year,month,day\in DATE \tfun \nat$}
%\attribute{\axiom $\forall d \in DATE \itholds d = date(year(d), month(d), day(d))$}
%\attribute{\query
%$valid\_date(y,m, d:\nat):\Bl$\newlineindent
%$\quad\qquad\eqdef$ $\ll$Table in Fig.~\ref{tabexp:valid-date}$\gg$ \newlineindent
%\comment is $(y,m,d)$ a valid date?}
%\attribute{\query $leap\_year(y:\nat): \Bl$\newlineindent
%$\qquad\eqdef mod(y,4)=0 ~\land~ mod(y,400) \notin \{100, 200, 300\}$\newlineindent
%\require $y \ge 1583$}
%\attribute{\query $to\_string(d:DATE): \St$ \newlineindent
%$\qquad\eqdef d.year.to\_string + ``-"$\newlineindent 
%$\qquad\qquad + d.month.to\_string + ``-"$\newlineindent
%$\qquad\qquad + d.day.to\_string$}
%
%\attribute{\query $\textbf{~infix~} ``\cong" (d1,d2: DATE): \Bl$\newlineindent
%$\qquad\eqdef d1.month = d2.month \land d1.day=d2.day$\newlineindent
%\comment $``\cong"$ has higher precedence\newlineindent
%$\qquad\qquad$ than predicate logic operators 
%}
%\end{class}
%\end{tikzpicture}
%\label{subfig:date}

\begin{table}[H]
{
\centering
\begin{tabular}{|l|}

\hline
\multicolumn{1}{|c|}{\textbf{type DATE}}\\

\hline
\textbf{carrier set} DATE\\
$\qquad$date $\eqdef$ (year, month, day : $\mathbb{N}$)    -- injective constructor\\
$\qquad$$\qquad$\textbf{require} valid\_date(year, month, day)\\
\textbf{const} year, month, day $\in$ DATE -$\rightarrow$  $\mathbb{N}$\\
\textbf{axiom} $\forall$ d $\in$ DATE $ \itholds$d = date(year(d), month(d), day(d))\\
\textbf{query} valid\_date(y,m, d:$\mathbb{N}$) : $\mathbb{B}$\\
$\qquad$$\eqdef$ $<$$<$Table below$>$$>$\\
\textbf{query} leap\_year(y : $\mathbb{N}$) : $\mathbb{B}$\\
$\qquad$$\eqdef$ mod(y, 4) = 0 $\land$ mod(y, 400) $\notin$ {100,200,300)}\\
$\qquad$$\qquad$\textbf{require} y $\ge$ 1583\\


\hline
\end{tabular}
}
\end{table}


%%%%%%%%%%%%%%%
%\subfigure[Tabular expression for query: $valid\_date(y,m,d:\nat):\Bl$]{
%\small
%%%Stuff
\begin{table}[H]
{
\centering
\begin{tabular}{|l|l|l|l|l|}
\multicolumn{5}{l}{Below: $ly$ abbreviates $leap\_year$}\\
\hline
\multicolumn{4}{|c|}{} & $valid\_date$ \\ 
\hline
$~~ (1583 \leq y \leq 9999)$ & \multicolumn{3}{l|}{$m\in \{1,3,5,7,8,10,12\}$} &true\\ 
\cline{2-5}

$\land (1 \leq m \leq  12)$ & $m\in \{4,6,9,11\}$ & \multicolumn{2}{c|}{$d \leq 30$} &true \\ 
\cline{3-5}
$\land (1 \leq d \leq 31)$ &  & \multicolumn{2}{c|}{$d>30$} &false\\ 
\cline{2-5}

& $m=2$ & $ly(y)$ & $d\leq 29$ &true\\ 
\cline{4-5}
&  &  & $d>29$ &false\\ 
\cline{3-5}
&  & $\lnot ly(y)$ & $d\leq 28$ &true\\ 
\cline{4-5}
&  &  & $d>28$ &false\\ 
\cline{1-5}
\multicolumn{4}{|l|}{not the above } &false\\ 
\hline
\end{tabular}
}
\end{table}
%%\caption{Tabular expression for query $valid\_date$}
%\label{tabexp:valid-date}
%\normalsize
%}
%\end{mdframed}%%Put a frame around the figure

%%%%%%%%%%%%%%%



\end{document}


